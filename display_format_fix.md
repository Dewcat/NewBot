# 🎯 伤害显示格式修复

## 问题描述
1. **抗性显示错误**：0.2抗性显示为-19%而不是-20%
2. **攻防修正格式**：显示×1.1而不是+10%

## 根本原因
1. **浮点数精度问题**：`int((1 - 0.8) * 100)` = `int(0.19999999999999996 * 100)` = 19
2. **显示格式不一致**：乘数格式vs百分比格式

## 修复内容

### ✅ 抗性显示修复
```python
# 修复前
resistance_percent = int((1 - resistance_reduction) * 100)

# 修复后  
original_resistance = target_resistances.get(damage_type, 0.0)
resistance_percent = round(original_resistance * 100)
```

### ✅ 攻防修正格式修复
```python
# 修复前
damage_details.append(f"攻防: ×{attack_defense_modifier:.2f}")

# 修复后
percent_change = (attack_defense_modifier - 1.0) * 100
if percent_change > 0:
    damage_details.append(f"攻防: +{percent_change:.0f}%")
else:
    damage_details.append(f"攻防: {percent_change:.0f}%")
```

## 🧪 测试用例

### 1. 抗性显示测试
```
设置抗性：0.2 (20%)
预期显示：物理抗性: -20%
```

### 2. 攻防修正测试
```
攻击者攻击力：15
目标防御力：10
攻防差：+5
修正：1 + (5 × 2%) = 1.1
预期显示：攻防: +10%
```

```
攻击者攻击力：8  
目标防御力：12
攻防差：-4
修正：1 + (-4 × 2%) = 0.92
预期显示：攻防: -8%
```

## 📋 新的伤害显示示例

### 示例1：高攻击vs低防御+抗性
```
攻击者：战士 (攻击20)
目标：法师 (防御5, 物理抗性30%)
技能：利刃封喉 (对人类+60%)

显示：⚔️ 物理伤害：基础: 10+1d2(1) → 攻防: +30% → 特攻(人类): ×1.6 → 物理抗性: -30% → 最终: 12
```

### 示例2：低攻击vs高防御
```
攻击者：法师 (攻击8)
目标：战士 (防御15)
技能：魔法箭

显示：🔮 魔法伤害：基础: 5+1d6(3) → 攻防: -14% → 最终: 7
```

## 🎯 优势
- ✅ **一致的百分比格式**：+10%, -20%等
- ✅ **精确的抗性显示**：避免浮点数精度问题
- ✅ **清晰的正负标识**：明确显示增益(+)和减益(-)
- ✅ **易于理解**：百分比比乘数更直观

## 机器人状态
🟢 已重启，修复生效
